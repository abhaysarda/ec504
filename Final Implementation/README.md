Our final implementation using LSH and KD-trees on the problem
